<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dilemma Lab (Mørk)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Dilemma Lab</h1>
        <p>Utforsk strategier i Prisoner's Dilemma</p>
    </header>

    <main>
        <div class="config-section">
            <h2>Konfigurasjon</h2>
            <div class="player-setup">
                <!-- Spiller 1 Konfigurasjon -->
                <div class="player-config">
                    <h3>Spiller 1</h3>
                    <div class="setting">
                        <label for="p1-type">Type:</label>
                        <select id="p1-type">
                            <option value="human">Menneske</option>
                            <option value="ai">AI</option>
                        </select>
                    </div>
                    <div class="setting ai-options p1">
                        <label for="p1-strategy">Strategi:</label>
                        <select id="p1-strategy">
                            <!-- Strategier lastes her -->
                        </select>
                    </div>
                </div>
                <!-- Spiller 2 Konfigurasjon -->
                <div class="player-config">
                    <h3>Spiller 2</h3>
                    <div class="setting">
                        <label for="p2-type">Type:</label>
                        <select id="p2-type">
                            <option value="ai" selected>AI</option>
                            <option value="human">Menneske</option>
                        </select>
                    </div>
                    <div class="setting ai-options p2">
                        <label for="p2-strategy">Strategi:</label>
                        <select id="p2-strategy">
                            <!-- Strategier lastes her -->
                        </select>
                    </div>
                </div>
            </div>
             <div class="global-settings">
                 <h3>Globale Spillinnstillinger</h3>
                 <div class="setting">
                     <label for="rounds-setting">Maks runder (for auto/turnering):</label>
                     <input type="number" id="rounds-setting" value="100" min="1" max="1000">
                 </div>
                <!-- Støy kan legges til her senere om ønskelig -->
            </div>
            <button id="reset-game-btn">Nullstill / Start Nytt Spill</button>
        </div>

        <div class="game-section hidden">
            <h2>Spill</h2>
            <div class="game-status">
                Runde: <span id="round-counter">0</span> |
                P1 Poeng: <span id="p1-score">0</span> (<span id="p1-avg-score">0.00</span> avg) |
                P2 Poeng: <span id="p2-score">0</span> (<span id="p2-avg-score">0.00</span> avg)
            </div>
            <div class="player-actions">
                 <!-- Spiller 1 Handlinger -->
                <div class="player-action-panel p1">
                    <h4>Spiller 1 (<span class="p1-id">Menneske</span>)</h4>
                    <p class="p1-strategy-name hidden"></p>
                    <div class="human-controls p1">
                         <button class="choice-btn cooperate p1" data-choice="C">Samarbeid</button>
                         <button class="choice-btn defect p1" data-choice="D">Svik</button>
                    </div>
                    <div class="action-display p1">Valg: <span class="chosen">?</span></div>
                </div>
                 <!-- Spiller 2 Handlinger -->
                 <div class="player-action-panel p2">
                     <h4>Spiller 2 (<span class="p2-id">AI</span>)</h4>
                     <p class="p2-strategy-name"></p>
                     <div class="human-controls p2 hidden">
                          <button class="choice-btn cooperate p2" data-choice="C">Samarbeid</button>
                          <button class="choice-btn defect p2" data-choice="D">Svik</button>
                     </div>
                     <div class="action-display p2">Valg: <span class="chosen">?</span></div>
                 </div>
            </div>
             <div class="game-controls">
                 <button id="play-step-btn" disabled>Spill 1 Trekk</button>
                 <button id="play-10-btn" disabled>Spill 10 Trekk</button>
                 <button id="play-100-btn" disabled>Spill 100 Trekk</button>
                 <button id="play-all-btn">Spill Resten / Stopp</button>
                 <label for="play-speed">Hastighet (for auto):</label>
                 <input type="range" id="play-speed" min="10" max="1000" value="200" step="10">
                 <span id="speed-value">200</span>ms
             </div>
             <div class="history-log">
                 <h3>Historikk (siste 20 trekk)</h3>
                 <ul id="history-list"></ul>
             </div>
             <div class="game-over-message hidden">
                 Spillet er ferdig!
             </div>
        </div>

        <div class="custom-strategy-section config-section">
             <h2>Definer Egen Agent</h2>
             <div class="setting">
                 <label for="custom-name">Agent Navn:</label>
                 <input type="text" id="custom-name" placeholder="MinAgentNavn">
             </div>
             <div class="setting">
                  <label for="custom-code">Agent Kode (JS):</label>
                  <textarea id="custom-code" rows="10" placeholder="function(myHistory, oppHistory) { return 'C'; }"></textarea>
             </div>
              <p class="code-help">Funksjonen mottar `myHistory` og `oppHistory`.<br>Hver er en liste av objekter: `{ choice: 'C'/'D', intended: 'C'/'D', errored: boolean }`.<br>Returner 'C' eller 'D'.</small></p>
              <p><small><b>Advarsel:</b> Kjør kun kode du forstår. Utrygg kode kan være en sikkerhetsrisiko.</small></p>
             <button id="add-custom-btn">Legg til Agent</button>
        </div>

        <div class="tournament-section config-section">
            <h2>Turnering</h2>
            <p>Velg agenter som skal delta (minst 2). Runder/støy fra globale innstillinger.</p>
            <div id="tournament-agent-list">
                <!-- Agenter lastes her -->
            </div>
            <button id="start-tournament-btn">Kjør Turnering</button>
            <div id="tournament-status" class="hidden"></div>
            <div class="tournament-results hidden">
                <h3>Resultater (Gj.snitt Poeng per Runde)</h3>
                <table id="tournament-results-table">
                    <thead><tr><th>Rank</th><th>Agent</th><th>Gj.snitt Poeng</th></tr></thead>
                    <tbody><!-- Resultater lastes her --></tbody>
                </table>
            </div>
        </div>

    </main>

    <footer>
        <div class="payoff-matrix-ref">
            <h4>Referanse: Poengmatrise</h4>
            <table>
                <tr><th></th><th>P2 C</th><th>P2 D</th></tr>
                <tr><th>P1 C</th><td>P1: 3, P2: 3</td><td>P1: 0, P2: 5</td></tr>
                <tr><th>P1 D</th><td>P1: 5, P2: 0</td><td>P1: 1, P2: 1</td></tr>
            </table>
        </div>
    </footer>

    <script src="script.js"></script>
</body>
</html>
